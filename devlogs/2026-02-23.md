# Devlog — 2026-02-23

## v0.7.0: AI 创意总监 3-Agent 流水线

### 做了什么

将单一 AI 对话改造为 3-Agent 专业流水线：

1. **Creative Consultant (Agent 1)** — 与用户对话 1-3 轮，澄清角色、风格、故事需求，输出结构化 concept brief (temperature 0.7)
2. **Storyboard Director (Agent 2)** — 接收 concept brief，运用专业镜头语言（景别/运镜/构图/灯光/动漫技法）生成分镜脚本 (temperature 0.5)
3. **Prompt Engineer (Agent 3)** — 针对 Seedance 1.5 模型特性优化每个场景 prompt，控制在 50-120 词 (temperature 0.3)

用户体验不变——只和 Agent 1 对话，后端检测到 concept brief 后自动链式触发 Agent 2 → Agent 3。

### 为什么这样做

- **单一 AI prompt 无法兼顾创意发散和技术精确**：temperature 0.7 适合创意对话，但 prompt 工程需要 0.3 的精确度
- **专业分工**：分镜师需要镜头语言知识，prompt 工程师需要模型偏好知识，塞在同一个 prompt 里效果差
- **渐进式降温**：0.7 → 0.5 → 0.3，从发散到收敛，模拟真实影视制作流程

### 关键决策

| 决策 | 选项 | 选择 | 原因 |
|------|------|------|------|
| Agent 间通信 | 消息队列 vs 函数调用 | 函数调用 | 同步链式调用足够，无需异步开销 |
| concept brief 检测 | 固定轮数 vs 内容标记 | 内容标记 (JSON 代码块) | 灵活，用户随时可以结束对话 |
| Agent 3 失败处理 | 中断 vs fallback | fallback 到 Agent 2 原始输出 | 保证用户总能看到结果 |
| 默认 Provider | kling vs jimeng | jimeng (Seedance 1.5) | 画质更好、API 更稳定 |

### 新增文件

```
backend/app/services/creative/agents/
├── __init__.py
├── consultant.py       # Agent 1 prompt
├── storyboarder.py     # Agent 2 prompt
└── prompt_engineer.py  # Agent 3 prompt
```

### 修改文件

- `director.py` — 从简单对话转发改为流水线编排（concept brief 检测 → Agent 2 → Agent 3）
- `creative.py` — provider 验证和默认值调整
- `settingsStore.ts` — defaultProvider: jimeng
- `hailuo.py` — Seedance 2.0 升级预留注释

### 遇到的问题

无重大阻塞。设计阶段花了较多时间确定 concept brief 的 JSON 格式和检测机制。

### 下一步

- T-01: E2E 测试验证 3-Agent 流水线
- Backlog: Seedance 2.0 模型升级
